Version 4
SHEET 1 4360 3428
WIRE -1264 -16 -1264 -96
WIRE -976 0 -976 -80
WIRE -1856 32 -1856 -48
WIRE -1120 144 -1200 144
WIRE -976 144 -976 80
WIRE -976 144 -1040 144
WIRE -1936 208 -2048 208
WIRE -1856 208 -1856 112
WIRE -848 208 -848 176
WIRE -1712 224 -1712 160
WIRE -1264 224 -1264 64
WIRE -976 224 -976 144
WIRE -880 224 -976 224
WIRE -1856 240 -1856 208
WIRE -1744 240 -1856 240
WIRE -1264 240 -1264 224
WIRE -1200 240 -1200 224
WIRE -672 240 -816 240
WIRE -640 240 -672 240
WIRE -1584 256 -1680 256
WIRE -1552 256 -1584 256
WIRE -880 256 -976 256
WIRE -1744 272 -1856 272
WIRE -1936 352 -2048 352
WIRE -1856 352 -1856 272
WIRE -2624 400 -2672 400
WIRE -2480 400 -2560 400
WIRE -1120 400 -1152 400
WIRE -976 400 -976 256
WIRE -976 400 -1040 400
WIRE -976 432 -976 400
WIRE -880 432 -976 432
WIRE -672 432 -672 240
WIRE -672 432 -800 432
WIRE -1856 448 -1856 352
WIRE -1776 448 -1856 448
WIRE -1584 448 -1584 256
WIRE -1584 448 -1696 448
WIRE 816 464 672 464
WIRE 864 464 816 464
WIRE 1056 464 960 464
WIRE 1200 464 1056 464
WIRE 1392 464 1280 464
WIRE 1440 464 1440 416
WIRE 1440 464 1392 464
WIRE 1504 464 1440 464
WIRE 1632 464 1632 416
WIRE 1632 464 1584 464
WIRE 1680 464 1632 464
WIRE 1920 464 1744 464
WIRE 2624 464 2624 368
WIRE 2624 464 1920 464
WIRE 1920 480 1920 464
WIRE -1264 496 -1264 288
WIRE -1152 496 -1152 400
WIRE -3152 528 -3312 528
WIRE -2944 528 -3072 528
WIRE 672 528 672 464
WIRE 1392 528 1392 464
WIRE 2624 528 2624 464
WIRE 1056 544 1056 464
WIRE -2672 560 -2672 400
WIRE -2608 560 -2672 560
WIRE -2480 560 -2480 400
WIRE -2480 560 -2528 560
WIRE 1920 624 1920 560
WIRE 1952 624 1920 624
WIRE 1920 672 1920 624
WIRE 2624 672 2624 608
WIRE 672 688 672 608
WIRE 1056 688 1056 608
WIRE 1056 688 672 688
WIRE 1392 688 1392 592
WIRE 1392 688 1056 688
WIRE -3312 704 -3312 528
WIRE -3120 704 -3312 704
WIRE -2944 720 -2944 528
WIRE -2944 720 -3056 720
WIRE -2816 720 -2944 720
WIRE -2672 720 -2672 560
WIRE -2672 720 -2736 720
WIRE -2608 720 -2672 720
WIRE -3120 736 -3168 736
WIRE -2480 736 -2480 560
WIRE -2480 736 -2544 736
WIRE -2160 736 -2480 736
WIRE -2944 752 -2944 720
WIRE -2608 752 -2672 752
WIRE 1056 752 1056 688
WIRE 816 784 816 464
WIRE -2576 800 -2576 768
WIRE 1920 800 1920 752
WIRE 2624 816 2624 752
WIRE -3312 848 -3312 704
WIRE -3168 864 -3168 736
WIRE -2944 864 -2944 832
WIRE -2944 864 -3168 864
WIRE -1920 880 -1920 848
WIRE -2944 896 -2944 864
WIRE -2672 896 -2672 752
WIRE -2160 896 -2160 736
WIRE -1952 896 -2160 896
WIRE -1648 912 -1888 912
WIRE -1952 928 -2096 928
WIRE -1920 944 -1920 928
WIRE -1920 976 -1920 944
WIRE -4096 992 -4096 928
WIRE -3952 992 -3952 928
WIRE -3312 992 -3312 912
WIRE -2944 992 -2944 976
WIRE -2944 992 -3312 992
WIRE -2096 992 -2096 928
WIRE 816 992 816 864
WIRE 944 992 944 512
WIRE 944 992 816 992
WIRE -2944 1024 -2944 992
WIRE 816 1056 816 992
WIRE 560 1104 560 976
WIRE 640 1104 560 1104
WIRE 752 1104 720 1104
WIRE -4096 1152 -4096 1072
WIRE -3952 1152 -3952 1072
WIRE 816 1200 816 1152
WIRE -1264 1616 -1344 1616
WIRE -1120 1616 -1184 1616
WIRE -1456 1824 -1552 1824
WIRE -1344 1824 -1344 1616
WIRE -1344 1824 -1376 1824
WIRE -1232 1840 -1232 1792
WIRE -1344 1856 -1344 1824
WIRE -1264 1856 -1344 1856
WIRE -1120 1872 -1120 1616
WIRE -1120 1872 -1200 1872
WIRE -1056 1872 -1120 1872
WIRE -1264 1888 -1344 1888
WIRE -1232 1936 -1232 1904
WIRE -1456 1968 -1536 1968
WIRE -1344 1968 -1344 1888
WIRE -1344 1968 -1376 1968
WIRE -1344 2016 -1344 1968
WIRE -1536 2096 -1536 2048
WIRE -1344 2128 -1344 2096
WIRE 2400 2192 2304 2192
WIRE 2176 2224 2176 2048
WIRE 2176 2224 2128 2224
WIRE 2224 2224 2176 2224
WIRE 2544 2256 2304 2256
WIRE 1600 2288 1600 2256
WIRE 2176 2288 2128 2288
WIRE 2224 2288 2176 2288
WIRE 1568 2304 1376 2304
WIRE 1856 2320 1632 2320
WIRE 2400 2320 2304 2320
WIRE 1568 2336 1504 2336
WIRE 1856 2352 1856 2320
WIRE 1600 2384 1600 2352
WIRE 2176 2400 2176 2288
WIRE 1856 2448 1856 2432
WIRE 2112 2448 1856 2448
WIRE 1856 2496 1856 2448
WIRE 1360 2512 1360 2448
WIRE 2176 2560 2176 2496
WIRE 1360 2608 1360 2592
WIRE 1504 2608 1504 2336
WIRE 1504 2608 1360 2608
WIRE 1360 2624 1360 2608
WIRE 1856 2640 1856 2576
WIRE 1360 2736 1360 2704
FLAG 1056 752 0
FLAG 816 1200 0
FLAG -2944 1024 0
FLAG -4096 1152 0
FLAG -3952 1152 0
FLAG -4096 928 Vcc
IOPIN -4096 928 BiDir
FLAG -3952 928 Vee
IOPIN -3952 928 BiDir
FLAG -3088 688 Vcc
IOPIN -3088 688 BiDir
FLAG -3088 752 Vee
IOPIN -3088 752 BiDir
FLAG -2576 704 Vcc
IOPIN -2576 704 BiDir
FLAG -2672 896 0
FLAG -1856 -48 0
FLAG -1712 288 Vcc
IOPIN -1712 288 BiDir
FLAG -976 -80 0
FLAG -1264 496 0
FLAG -1264 -96 Vcc
IOPIN -1264 -96 BiDir
FLAG -848 272 Vcc
IOPIN -848 272 BiDir
FLAG -1552 256 Vout1
IOPIN -1552 256 BiDir
FLAG -640 240 Vout2
IOPIN -640 240 BiDir
FLAG -1152 496 Vout1
IOPIN -1152 496 BiDir
FLAG -1920 976 Vcc
IOPIN -1920 976 BiDir
FLAG -2096 992 Compartor_Ref
IOPIN -2096 992 BiDir
FLAG -1648 912 PWM
IOPIN -1648 912 BiDir
FLAG 560 976 PWM
IOPIN 560 976 BiDir
FLAG -1920 848 Vee
IOPIN -1920 848 BiDir
FLAG -2048 208 Rsense+
IOPIN -2048 208 BiDir
FLAG -2048 352 Rsense-
IOPIN -2048 352 BiDir
FLAG 1440 416 Rsense+
IOPIN 1440 416 BiDir
FLAG 1632 416 Rsense-
IOPIN 1632 416 BiDir
FLAG 1920 800 0
FLAG -1344 2128 0
FLAG -1232 1792 Vcc
IOPIN -1232 1792 BiDir
FLAG 1952 624 Battery_ref
IOPIN 1952 624 BiDir
FLAG -1552 1824 Battery_ref
IOPIN -1552 1824 BiDir
FLAG -1056 1872 Vout3
IOPIN -1056 1872 BiDir
FLAG 1600 2384 Vcc
IOPIN 1600 2384 BiDir
FLAG 1856 2640 0
FLAG 2176 2560 0
FLAG 2176 2048 Vcc
IOPIN 2176 2048 BiDir
FLAG 2400 2192 Vout2
IOPIN 2400 2192 BiDir
FLAG 2400 2320 Vout3
IOPIN 2400 2320 BiDir
FLAG 2544 2256 Compartor_Ref
IOPIN 2544 2256 BiDir
FLAG 2624 816 0
FLAG 2624 368 Battery+
IOPIN 2624 368 BiDir
FLAG 1376 2304 Battery+
IOPIN 1376 2304 BiDir
FLAG -2576 800 Vee
IOPIN -2576 800 BiDir
FLAG -1200 240 0
FLAG -1536 2096 0
FLAG -1712 160 Vee
IOPIN -1712 160 BiDir
FLAG -848 176 Vee
IOPIN -848 176 BiDir
FLAG -1232 1936 Vee
IOPIN -1232 1936 BiDir
FLAG 1600 2256 Vee
IOPIN 1600 2256 BiDir
FLAG 1360 2736 0
FLAG 1360 2448 Vcc
IOPIN 1360 2448 BiDir
SYMBOL nmos 864 512 R270
SYMATTR InstName M1
SYMATTR Value IRF530
SYMBOL schottky 1072 608 R180
WINDOW 0 24 64 Left 2
WINDOW 3 -80 -20 Left 2
SYMATTR InstName D1
SYMATTR Value MBR735
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL ind 1184 480 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 12.5mH
SYMBOL cap 1376 528 R0
SYMATTR InstName C1
SYMATTR Value 187µF
SYMBOL voltage 672 512 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 30v
SYMBOL npn 752 1056 R0
SYMATTR InstName Q3
SYMATTR Value 2N3019
SYMBOL res 736 1088 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 1k
SYMBOL res -2960 736 R0
SYMATTR InstName R4
SYMATTR Value 35k
SYMBOL res -2960 880 R0
SYMATTR InstName R5
SYMATTR Value 30k
SYMBOL voltage -4096 976 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 15
SYMBOL voltage -3952 1088 R180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value 15
SYMBOL res -3056 512 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 40k
SYMBOL cap -3328 848 R0
SYMATTR InstName C3
SYMATTR Value 0.01µF
SYMBOL OpAmps\\RH27C -3088 656 R0
SYMATTR InstName U2
SYMBOL OpAmps\\RH27C -2576 672 R0
SYMATTR InstName U1
SYMBOL cap -2560 384 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C4
SYMATTR Value 1µ
SYMBOL res -2720 704 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 330
SYMBOL res -2512 544 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R
SYMATTR Value 1k
SYMBOL res -1840 192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 10k
SYMBOL res -1840 336 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 10k
SYMBOL OpAmps\\OP747 -1712 320 M180
SYMATTR InstName U4
SYMBOL res -1872 16 R0
SYMATTR InstName R14
SYMATTR Value 51k
SYMBOL res -1680 432 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R15
SYMATTR Value 51k
SYMBOL OpAmps\\OP747 -848 304 M180
SYMATTR InstName U5
SYMBOL res -1024 128 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R16
SYMATTR Value 10k
SYMBOL res -1024 384 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R17
SYMATTR Value 10k
SYMBOL res -992 -16 R0
SYMATTR InstName R18
SYMATTR Value 33k
SYMBOL res -784 416 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R19
SYMATTR Value 33k
SYMBOL res -1280 -32 R0
SYMATTR InstName R20
SYMATTR Value 1k
SYMBOL OpAmps\\RH27C -1920 976 M180
SYMATTR InstName U6
SYMBOL res 1600 448 R90
WINDOW 0 0 56 VBottom 1
WINDOW 3 32 56 VTop 2
SYMATTR InstName Current_sense_resistor
SYMATTR Value 1
SYMBOL zener -1248 288 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D3
SYMATTR Value UDZV6_2B
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL res 1904 464 R0
SYMATTR InstName R2
SYMATTR Value 100k
SYMBOL res 1904 656 R0
SYMATTR InstName R11
SYMATTR Value 33k
SYMBOL OpAmps\\OP747 -1232 1808 R0
SYMATTR InstName U7
SYMBOL res -1360 1808 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R21
SYMATTR Value 10k
SYMBOL res -1360 1952 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R22
SYMATTR Value 10k
SYMBOL res -1168 1600 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R23
SYMATTR Value 10k
SYMBOL res -1360 2000 R0
SYMATTR InstName R24
SYMATTR Value 10k
SYMBOL schottky 1680 480 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 92 62 VBottom 2
SYMATTR InstName D4
SYMATTR Value 30BQ060
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL OpAmps\\OP747 1600 2384 M180
SYMATTR InstName U9
SYMBOL res 1840 2336 R0
SYMATTR InstName R29
SYMATTR Value 10k
SYMBOL res 1840 2480 R0
SYMATTR InstName R30
SYMATTR Value 5k
SYMBOL npn 2112 2400 R0
SYMATTR InstName Q5
SYMATTR Value 2SD2700
SYMBOL Relay 2256 2256 R0
SYMATTR InstName 12V_Relay
SYMBOL diode 2144 2288 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D5
SYMBOL voltage 2624 656 R0
WINDOW 3 -182 103 Left 1
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PWL(0 0 200m 3 400m 6 600m 9 800m 12 1000m 13 1.2 13.2 1.4 13.3 1.5 13.5 1.6 13.6 1.8 13.7 2 13.8)
SYMATTR InstName V6
SYMBOL res 2608 512 R0
SYMATTR InstName R32
SYMATTR Value 1
SYMBOL voltage -1200 128 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 5.1
SYMBOL voltage -1536 1952 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 3.3v
SYMBOL res 1344 2496 R0
SYMATTR InstName R10
SYMATTR Value 5k
SYMBOL res 1344 2608 R0
SYMATTR InstName R25
SYMATTR Value 55k
SYMBOL res 800 768 R0
SYMATTR InstName R1
SYMATTR Value 10k
TEXT 304 680 Left 3 !.tran 2s uic
TEXT 976 112 Left 2 ;POWER stage of the BUCK CONVERTER
TEXT -2008 -176 Left 2 ;1st Differential amplifier
TEXT -1696 120 Left 1 ;Vout1 = 4.7( Delta V )
TEXT -1248 280 Left 1 ;6.2V zener
TEXT -704 160 Left 1 ;Vout2 = 3.3 ( 5.1- Vin)  ; Vin = Vout1
TEXT -1384 16 Left 0 ;Select the correct resistor depends on the zener diode
TEXT -1176 -216 Left 2 ;2nd Differential amplifier
TEXT -2160 872 Left 1 ;Triangular Wave
TEXT -2056 1144 Left 2 ;Comparator
TEXT -3248 368 Left 2 ;Astable Multivibrator
TEXT -2928 696 Left 1 ;Square wave
TEXT -2624 312 Left 2 ;Integrator
TEXT -1176 1400 Left 2 ;Constant Voltage Error amplifier
TEXT -1112 1848 Left 1 ;(3.3 - Battery_ref)
TEXT -1352 1536 Left 1 ;3rd Differential amplifier
TEXT -1480 -360 Left 2 ;Constant current controller
TEXT 2200 2760 Left 2 ;Relay driver
TEXT 2648 416 Left 2 ;Load Simulation
TEXT -1128 -928 Left 6 ;LEAD ACID BATTERY CHARGER
TEXT 1392 2608 Left 1 ;13.75v
TEXT 1568 2088 Left 1 ;Comparator
TEXT 1528 1824 Left 2 ;Switching circuit  CC to CV at 13.8V
RECTANGLE Normal -1760 1088 -2192 768 1
RECTANGLE Normal -160 2272 -1760 1424 1
RECTANGLE Normal -384 624 -2208 -320 1
RECTANGLE Normal 2256 1536 -80 0 1
RECTANGLE Normal 2832 1856 496 2960 3
RECTANGLE Normal -2832 1136 -3392 400 2
RECTANGLE Normal -2336 992 -2816 336 2
RECTANGLE Normal 2960 896 2448 432 2
